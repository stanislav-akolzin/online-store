# Проект ИНТЕРНЕТ-МАГАЗИН

В данном файле содержится описание проекта и инструкция по его тестированию и использованию.

Развертывание проекта описано для unix систем. Для разворачивания на Windows процедура практически идентична, а отличия могут быть описаны отдельно.
Для развертывания проекта предполагается, что в системе установлен Python, а также Postgresql.

Проект представляет собой интернет-магазин. Приложение предоставляет REST интерфейс. Реализованы возможности просмотра и изменения данных, аутентификация пользователей.


## Суть проекта:
Реализация REST-интерфейса для интернет-магазин (без фронтенда).

В базе данных должны содержаться:
1. Категории товаров (наименование и описание)
2. Сами товары (наименование, описание, цена, количество, категория)
3. История изменений (т.е. при поступлении или выбытии товаров автоматически должны сохраняться информация о движениях)

Приложение предоставляет 2 endpoints:
1. register. Принимает name, email, password, password_confirmation. Возвращает access_token при успешной регистрации.
2. login. Принимает email, password. Возвращает access_token при успешной аутентификации.

Запросы, не требующие аутентификации:
1. Список товаров.

Запросы, требующие аутентификацию:
1. Список категорий
2. Добавление, изменение, удаление категории.
3. Добавление, изменений, удаление товара.
4. Просмотр информации о товаре.



## Разворачивание проекта.
1. Создать директорию, в которую будет помещен каталог с проектом.

2. Выполнить команду `git clone https://github.com/stanislav-akolzin/test_task` - клонирование репозитория с проектом из github на локальную машину.

3. Зайти в созданный каталог 'test_task' и выполнить `python3 -m venv env` - создание виртуального окружения под именем 'env'.

4. Выполнить команду `. env/bin/activate` - активация виртуального окружения.

5. Выполнить команду `pip install -r requirements.txt` - установка всех зависимостей для проекта.

6. Необходимо создать в postgres новую базу данных. Определить для неё пользователя и пароль.

7. Внести изменения в файл settings.py проекта online_store
    `DATABASES = {
      'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': '<base_name>',
        'USER': '<base_user>',
        'PASSWORD': '<user_password>',
        'HOST': '<host>',
        'PORT': '<port>',
      } 
    }`

8. Такие же изменения надо внести в файл initial_sql_script.py в каталоге проекта
`con = psycopg2.connect(
    database='<base_name>',
    user='<base_user>',
    password='<user_password>',
    host='<host>',
    port='<port>',
)`

9. Теперь необходимо выполнить миграцию, чтобы на основании данных о моделях из проекта создались соответствующие таблицы и связи в базе данных
`python manage.py migrate`

10. После этого надо применить скрипт 'initial_sql_script.py', который заполнит таблицы в БД данными
`python initial_sql_script.py`

11. Теперь создаем пользователя для входа в админку django
`python manage.py createsuperuser`
Можно войти в админку и посмотреть как выполнилось первичное наполнение базы данными.



## Тестирование и использование проекта
Тестировать программу удобно с помощью специальных утилит, например, Postman. На основании использования этой программы будет написана дальнейшая инструкция. В других утилитах процесс тестирования и использования аналогичен.

В проекте содержатся данные о товарах, их категориях, а также всех изменения количества товара, включая первичное размещение.

### Аутентификация
Система аутентификации предоставляет 2 endpoints: api/register и api/login.
При первичной регистрации пользователь отправляет POST запросом на register (1) в теле запроса (2) в виде форм-даты (3) данные name, email, password, password_confirmation (4)
![image](https://user-images.githubusercontent.com/78170834/142824988-e474cc5d-d9ac-4e37-bfc1-dbcbec98db86.png)

Если данные некорректны (например, какие-то поля не заполнены, или не совпадают пароли), то система вернет ошибку. Если всё ок, то система возвращает ответ с сообщением об успешном добавлении пользователя и выдачей ему токена
![image](https://user-images.githubusercontent.com/78170834/142825352-827930d6-ffe5-44b0-b92b-840ad6313603.png)

Этот токе надо использовать для дальнейшего взаимодействия с приложением.

Для уже существующих пользователей вход через api/login. В теле запроса передаются данные username и password. Если данные некорректны или пользователя не существует, то система выдаст соответствующее уведомление. Если всё ок, то выдается токен
![image](https://user-images.githubusercontent.com/78170834/142825822-299fa6b1-0e44-4eae-a80e-ba3ea7334f2c.png)
![image](https://user-images.githubusercontent.com/78170834/142825843-5a65f148-4b77-49d9-a94d-3338c7f2dae4.png)

Полученный в обоих случаях токен надо использовать для отправки запросов, требующих аутентификации, путем добавления к запросу заголовка 'Authorization' со значением 'Token <your_token>
![image](https://user-images.githubusercontent.com/78170834/142826029-24fd7bbf-956a-42e0-920e-e06d421cc4fa.png)

При отправке запроса, требующего аутентификации, без токена или с некорректным токеном система выдаст сообщение о необходимости аутентификации
![image](https://user-images.githubusercontent.com/78170834/142826148-c0b33c78-17dd-413f-a679-66b9282ab389.png)

### Работа с данными
Работа с данными реализована через адрес 'store' (.../api/store/...)
Всего реализовано 4 endpoints:
   - `api/store/items` - просмотр списка товаров с разделением по страницам (по 10 шт.)
   - `api/store/items/<id>` - просмотр детальных данных по конкретному товару с историей изменения его количества
   - `api/store/categories/` - просмотр, добавление, изменение, удаление категорий товаров
   - `api/store/items/change` - добавление, изменение, удаление конкретных товаров.
    
Для просмотра всех данных треубуется отправить GET запрос на соответствующий адрес без чего-либо в теле запроса.

***При работе с данными поиск в базе ведется по наименованию. Соответственно требования к входящим запросам - также содержание наименований. В реальных проектах использование наименований для идентификации это крайне плохая практика. Но в рамках тестового задания это сделано для упрощения тестирования и большей наглядности. !!!

Для добавления категории необходимо отправить POST запрос на `api/store/categories/`, а в теле запроса в формате JSON вложить данные следующей структуры
`{
	"category": {
		"name": "<category_name>",
		"description": "<category_description>"
	}
}`

Если данные корректны, то будет возвращен ответ
![image](https://user-images.githubusercontent.com/78170834/142827732-d2c9a09f-9191-4ab4-ac54-540d2ab681c3.png)

Для изменения категории необходимо отправить PUT запрос на `api/store/categories/`, а в теле запроса в формате JSON вложить данные структуры как и в предыдущем пункте
![image](https://user-images.githubusercontent.com/78170834/142828005-59d4ff86-c864-4cba-8ec8-7b05bd15ae80.png)

При корректности данных будет возвращен соответствующий ответ
![image](https://user-images.githubusercontent.com/78170834/142828062-c8bbd1e1-35f3-413d-af1c-6c75fd778e35.png)

Для удаления категории необходимо отправить DELETE запрос на `api/store/categories/`. В структуре данных в теле запроса в JSON достаточно, чтобы было наименование категории
![image](https://user-images.githubusercontent.com/78170834/142828230-608b98ee-c030-4da4-bb33-dae0f6d0cb3d.png)

В случае корректности данных будет возвращен соответствующий ответ
![image](https://user-images.githubusercontent.com/78170834/142828265-583c7675-5859-4f1d-a773-14c6a1c83e90.png)


Для добавления и изменения данных по товарам необходимо отправить запросы вида соответственно POST и PUT на адрес `api/store/items/change/` со структурой JSON в теле запроса
`{
	"item": {
		"name": "<item_name>",
        "description": "<item_description>",
        "category": <category_id>,
        "price": <item_price>,
        "quantity": <item_quantity>
	}
}`

В случае корректности данных будут возвращены соответствующие ответы
![image](https://user-images.githubusercontent.com/78170834/142829498-3a5d0f78-2602-406d-a6ba-e5b8aba6cfe9.png)
![image](https://user-images.githubusercontent.com/78170834/142829540-81d5f12b-329d-47ab-a2ed-afb3ea16597f.png)

Для удаления товаров необходимо отправить DELETE запрос на `api/store/items/change/`. В структуре JSON достаточно данных только о наименовании товара
![image](https://user-images.githubusercontent.com/78170834/142829797-e9fc4e30-8f38-471a-afa8-bb4ebd56321e.png)

В случае корректности данных будет возвращен ответ
![image](https://user-images.githubusercontent.com/78170834/142829805-9a567741-eda3-431f-b0db-4187868fe0aa.png)

Все данные по добавлени и изменению товара создают движения в таблице по изменениям товара. Данные по изменениями по каждому конкретному товару можно видеть при запросе детальных данных по товару через `api/store/items/id/`.
